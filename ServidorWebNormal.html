<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invernadero Domotizado</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>
<body>
    <div class="container mt-3">
    <table class="table table-dark">
      <thead>
        <th>Num.Registro</th>
        <th>Bomba de agua</th>
        <th>Bombilla</th>
        <th>Humedad del suelo</th>
        <th>Nivel del agua</th>
        <th>Puerta</th>
        <th>Temperatura del agua</th>
        <th>Temperatura del ambiente</th>
      </thead>
      <tbody id="tbody1"></tbody>
    </table>
  </div>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  <script type="module"> 
  // CORS
  // const cors2 = require('cors')
  // const corsOptions = {
  //   origin: '*',
  //   allowedHeaders: ['Content-Type', 'Authorization', 'Content-Length', 'X-Requested-With', 'Accept'],
  //   methods: ['GET', 'PUT', 'POST', 'DELETE', 'OPTIONS'],
  //   optionsSuccessStatus: 200 // some legacy browsers (IE11, various SmartTVs) choke on 204
  // };
  // app.use(cors2(corsOptions.methods("GET")));
  

    // Lennando la tabla con los datos de la base de datos
    var regNo = 0;
    var tbody = document.getElementById("tbody1");
    function AddItemToTable(bomba, bombilla, humedad, nivelAgua, puerta, tempAgua, tempAmbiente) {
      let trow = document.createElement("tr");
      let td1 = document.createElement("td");
      let td2 = document.createElement("td");
      let td3 = document.createElement("td");
      let td4 = document.createElement("td");
      let td5 = document.createElement("td");
      let td6 = document.createElement("td");
      let td7 = document.createElement("td");
      let td8 = document.createElement("td");

      td1.innerHTML =  ++regNo;
      td2.innerHTML =  bomba;
      td3.innerHTML =  bombilla;
      td4.innerHTML =  humedad;
      td5.innerHTML =  nivelAgua;
      td6.innerHTML =  puerta;
      td7.innerHTML =  tempAgua;
      td8.innerHTML =  tempAmbiente;
// bomba, bombilla, humedad, movimiento, puerta, tempAgua, tempAmbiente
      trow.appendChild(td1);
      trow.appendChild(td2);
      trow.appendChild(td3);
      trow.appendChild(td4);
      trow.appendChild(td5);
      trow.appendChild(td6);
      trow.appendChild(td7);
      trow.appendChild(td8);


      tbody.appendChild(trow);

    }
    
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAth51Y0Nr1wSgHHRmaRnFUvjyLTu6Um18",
    authDomain: "invernaderodomotizadodb.firebaseapp.com",
    databaseURL: "https://invernaderodomotizadodb-default-rtdb.firebaseio.com",
    projectId: "invernaderodomotizadodb",
    storageBucket: "invernaderodomotizadodb.appspot.com",
    messagingSenderId: "658102291357",
    appId: "1:658102291357:web:28a63e712da17358dffd74"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);

   import { getDatabase, ref, child, onValue, get }
   from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";
  // // Import the functions you need from the SDKs you need
  // import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
  // // TODO: Add SDKs for Firebase products that you want to use
  // // https://firebase.google.com/docs/web/setup#available-libraries

  // // Your web app's Firebase configuration
  // const firebaseConfig = {
  //   apiKey: "AIzaSyDQxiMJCJnNLgK1W1OusnXeKNQlwY-JV6g",
  //   authDomain: "dbproyectosp.firebaseapp.com",
  //   databaseURL: "https://dbproyectosp-default-rtdb.firebaseio.com",
  //   projectId: "dbproyectosp",
  //   storageBucket: "dbproyectosp.appspot.com",
  //   messagingSenderId: "241649420200",
  //   appId: "1:241649420200:web:fcf3903929a6eff70f3f9d"
  // };

  // // Initialize Firebase
  // const app = initializeApp(firebaseConfig);

  // import { getDatabase, ref, child, onValue, get }
  // from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";

  //Access-Control-Allow-Origin : "https://gstatic.com/firebasejs/9.14.0/firebase-database.js";
// CORS
// function CORSSolve(){
//   const xhttp = new XMLHttpRequest();
//   xhttp.onreadystatechange = function( ){
//     if(this.readyState == 4 && this.status == 200){
//       document.getElementById('data').innerText = xhttp.responseText;
//     }
//   };
//   xhttp.open("GET","https://dbproyectosp-default-rtdb.firebaseio.com",true)
//   xhttp.send();
// }
// CORSSolve();

//const cors = require('cors')({origin: true});
// Obtener la base de datos

// bomba, bombilla, humedad, movimiento, puerta, tempAgua, tempAmbiente
  const db = getDatabase();
    // Otra fubncion
    function AddAllItemsToTable(Sensores2){
      regNo++;
      tbody.innerHTML = "";
      Sensores2.forEach(element => {
        console.log(element)
        console.log()
    AddItemToTable(element.estadoBomba, element.estadoBombilla, element.humedadSuelo, element.nivelAgua, element.estadoPuerta, element.tempAgua, element.tempRelativa);
     
    // AddItemToTable(element.bomba,el)   
});
    }
// window.addEventListener('DOMContentLoaded',()=>{

// })

    // Obtener los datos
    function GetAllDataOnce () {
  //    CORSSolve();
      const dbRef = ref(db);
      get(child(dbRef,"Sensores2"))
      .then((snapshot) => {
        var sensores = [];
        snapshot.forEach(childSnapshot => {
          sensores.push(childSnapshot.val());
        });
        AddAllItemsToTable(sensores);
      })
    }
    window.onload = GetAllDataOnce;
    // Datos en tiempo real
    function GetAllDataRealTime(){
      const dbRef = ref(db, "Sensores2");
      onValue(dbRef,(snapshot)=>{
        var sensores = [];

        snapshot.forEach(childSnapshot => {
          sensores.push(childSnapshot.val());
        });
        AddAllItemsToTable(sensores);
      })
    }
    window.onload = GetAllDataRealTime;
  </script>
</body>
</html>